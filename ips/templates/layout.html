<!doctype html>
<html lang="en-gb" dir="ltr" class="no-js">
<head>
    {% block styles %}
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <title>International Passenger Survey</title>
        <meta content="width=device-width, initial-scale=1" name="viewport">

        <link rel="apple-touch-icon" sizes="180x180"
              href="{{ url_for('static', filename='img/favicons/apple-touch-icon.png.png') }}">

        <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicons/favicon-32x32.png') }}"
              sizes="32x32">

        <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicons/favicon-16x16.png') }}"
              sizes="16x16">

        <link rel="manifest" href="{{ url_for('static', filename='img/favicons/manifest.json') }}">

        <link rel="mask-icon" href="{{ url_for('static', filename='img/favicons/safari-pinned-tab.svg') }}"
              color="#5bbad5">

        <meta name="theme-color" content="#ffffff">
        <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.css'>

        <link rel="stylesheet" href="{{ url_for('static', filename='css/legacy-main.css') }}"
              media="all">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/builder.css')+"?v1.0.0" }}" media="all">

        <link rel="stylesheet" href="https://cdn.ons.gov.uk/sdc/design-system/17.0.0/css/main.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.min.js'></script>
    {% endblock %}
</head>

<body>
<header class="header header--internal">
    {% block header %}
        <section>
            <div class="header__top" role="banner">
                <div class="wrapper">
                    <div class="header__grid-top grid grid--gutterless grid--flex grid--between grid--vertical-center grid--no-wrap">
                        <div class="grid__col col-auto">
                            <div class="logo">
                                <a href="{{ url_for('dashboard.dashboard_view') }}">
                                    <img src="https://cdn.ons.gov.uk/sdc/v1.5.0/img/ons-logo-white.svg"
                                         alt="Office for National Statistics logo"
                                         class="logo__img header__logo print__hidden">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header__main header__main--border">
                <div class="wrapper">
                    <div class="grid grid--gutterless grid--align-mid u-cf">
                        <div class="grid__col col-10@xs col-6@s col-8@m">
                            <h1 class="header__title header__title--nav-adj">International Passenger Survey</h1>
                        </div>
                        <button class="btn btn--mobile js-nav-btn u-fr u-d-no--@s" type="button" id="menu-btn"
                                aria-expanded="false" aria-controls="main-nav" aria-label="Toggle main navigation"
                                aria-haspopup="true"><span class="btn--mobile__label"></span></button>
                        {% if current_user.is_authenticated %}
                            <div class="grid__col col-auto u-flex-no-shrink">
                                <button id="sign_out" class="btn btn--ghost">
                                    <span class="btn__inner">Sign out</span>
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="header__bottom">
                <div class="wrapper">
                    <nav class="header-nav__list" aria-label="Main menu"
                         id="main-nav" data-analytics="header-navigation">
                        <ul class="section-nav__list" aria-label="Navigation menu" role="menubar">
                            <li class="header-nav__item header-nav__item--active" role="menuitem" aria-current="page">
                                <a href="{{ url_for('dashboard.dashboard_view') }}" class="header-nav__link">Dashboard</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <br>
        </section>
    {% endblock %}
</header>

<section id="content">
    {% block content %}{% endblock %}
</section>

<footer class="page__footer">
    <!--Footer content-->
    {% block footer %}
{#        <div class="wrapper">#}
{#                <div class="grid__col col-auto u-flex-no-grow">#}
{#                    <h3 class="phase-banner__badge">In Dev</h3>#}
{#                </div>#}
{#                <div class="col-12">#}
{#                    <span class="new">This is a new service. Your <a#}
{#                            href="mailto:ramon.delgado@ext.ons.gov.uk?Subject=User%20feedback"> feedback</a> will help us improve it.</span>#}
{#                </div>#}
{#        </div>#}

        <script>
            jQuery(document).ready(function ($) {
                $(".clickable-row").click(function () {
                    window.location = $(this).data("href");
                });
            });
            $("#sign_out").click(function () {
                window.location.href = '/logout';
            });
        </script>

        <script>
            $('.ui.dropdown').dropdown();
        </script>

        <script type="text/javascript">
            $(function () {
                deliminator = 20;
                $("table.paginate").each(function () {
                    index = 1;
                    $(this).children("tbody").children("tr").each(function () {
                        $(this).attr("index", index);
                        if (index > deliminator) {
                            $(this).hide();
                        }
                        index += 1;
                    });
                    rows = $(this).children("tbody").children("tr").length;
                    pag_div = $("#" + $(this).attr("paginate"));
                    pages = setPaginateDiv(deliminator, rows, pag_div);
                    setPaginateListeners($(this), deliminator, pages, rows);
                });

            });

            function setPaginateDiv(deliminator, rows, div) {
                pages = Math.ceil(rows / deliminator);
                div.empty();
                if(rows < deliminator){
                    div.append("<label class='pag_info'>1 to "+rows+" of " + rows + "</label>");
                }else {
                    div.append("<label class='pag_info'>1 to 20 of " + rows + "</label>");
                }
                for (i = 1; i <= rows; i++) {
                    if (i === 1) {
                        div.append("<a current=true class='pag_index cur' index='" + i + "'>" + i + "</a>");
                    } else if (i <= 10) {
                        div.append("<a current=false class='pag_index' index='" + i + "' href='javascript:void(0)'>" + i + "</a>");
                    } else {
                        div.append("<a current=false class='pag_index' style='display:none' index='" + i + "' href='javascript:void(0)'>" + i + "</a>");
                    }
                    if(i == pages){
                        break;
                    }
                }
                div.append("<a current=false class='pag_index' href='#'>Next</a>");
                return pages;
            }

            function setPaginateListeners(table, deliminator, pages, rows) {
                $(".pag_index").click(function () {
                    if ($(this).hasClass("cur") == false) {
                        index = getPaginateIndex($(this));
                        if (index <= pages) {
                            showPaginateData($(this), table, index, deliminator)
                            showPaginatePages($(this), index, pages, rows, deliminator)
                        }
                    }
                });
            }

            function getPaginateIndex(page) {
                index = page.attr("index");
                if (index) {
                    index = parseInt(index);
                } else {
                    index = parseInt(page.parent().children(".cur").attr("index")) + 1;
                }
                return index;
            }

            function showPaginateData(page, table, index, deliminator) {
                $(table).children("tbody").children("tr").hide();
                for (i = (index - 1) * deliminator; i <= index * deliminator; i++) {
                    $(table).children("tbody").children("tr[index=" + i + "]").show();
                }
                page.parent().children(".cur").attr("href", "#");
                page.parent().children(".cur").removeClass("cur");
                page.parent().children("a[index=" + index + "]").addClass("cur");
                page.parent().children("a[index=" + index + "]").removeAttr("href");
            }

            function showPaginatePages(page, index, max, rows, deliminator) {
                page.parent().children("a[index]").hide();
                if (index - 5 <= 0) {
                    extra = (index - 5) * -1;
                } else if (index + 5 > max) {
                    extra = (index + 5 - max) * -1;
                } else {
                    extra = 0;
                }
                page.parent().children("a[index=" + index + "]").show();
                for (i = index; i > (index - 5 + extra); i--) {
                    page.parent().children("a[index=" + i + "]").show();
                }
                for (i = index + 1; i <= (index + 5 + extra); i++) {
                    page.parent().children("a[index=" + i + "]").show();
                }
                t = (index) * deliminator;
                console.log(t);
                page.parent().children("label").text((((index - 1) * deliminator) + 1) + " to " + ((t > rows) ? rows : t) + " of " + rows);
            }
        </script>​
    {% endblock %}

</footer>

</body>

</html>
